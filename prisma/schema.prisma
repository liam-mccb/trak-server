// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          Int      @id @default(autoincrement())
  ebayUserId  String   @unique
  username    String?
  deleted     Boolean  @default(false)
  deletedAt   DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

/// --------------  Item  --------------
model Item {
  id        Int            @id @default(autoincrement())
  name      String
  ebayQuery String         @unique      // e.g. "charizard holo 1st gen"

  variants  CardVariant[]                 // ← NEW (replaces priceHistory)

  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
}

/// --------------  CardVariant --------------
model CardVariant {
  id          Int            @id @default(autoincrement())

  /// parent card (Charizard Base 1st Ed…)
  item        Item           @relation(fields: [itemId], references: [id])
  itemId      Int

  /// grading details
  gradeLabel  String         // "Raw", "PSA", "BGS", "CGC"
  gradeValue  Float  @default(-1)   // Raw = -1, PSA 9 = 9, etc.

  priceHistory PriceSnapshot[]            // ← back-relation

  @@unique([itemId, gradeLabel, gradeValue])
}

/// --------------  PriceSnapshot --------------
model PriceSnapshot {
  id        Int         @id @default(autoincrement())

  /// which variant this price belongs to
  variant   CardVariant @relation(fields: [variantId], references: [id])
  variantId Int

  priceUsd  Float
  captured  DateTime    @default(now())
}
